<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <ui:composition template="/templatestudent.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.ListLevelsTitle}"></h:outputText>
        </ui:define>
        <ui:define name="body">

            <h:form id="QuestionsListForm" >

                <p:panel>
                    <p:outputLabel for="levelsids" value="Levels: " />

                    <p:selectOneMenu id="levelsids" value="#{questionsController.level}" style="width:150px" disabled="#{questionsController.teststarted}">
                        <p:ajax listener="#{questionsController.onLevelsChange}" update="datalist" />
                        <f:selectItem itemLabel="Select Level" itemValue="" noSelectionOption="true" />
                        <f:selectItems value="#{levelsController.itemsAvailableSelectOne}"
                                       var="levelidItem"
                                       itemValue="#{levelidItem}"/>
                    </p:selectOneMenu>
                    <p:commandButton disabled="#{questionsController.teststarted}" value="Start Test" id="ajaxstart" update="growl,ajaxfinish,ajaxstart,levelsids,tpoll,:QuestionsListForm:questionAnswer,datalist,datalistpanel" action="#{questionsController.starttest}"  />

                    <p:inputText  id="txt_count" value="Time: #{questionsController.timercount}" disabled="true">
                    </p:inputText>
                    <p:poll id="tpoll" interval="1"  update="txt_count,ajaxfinish,ajaxstart"   />
                    
                    <p:commandButton  disabled="#{!questionsController.teststarted}" value="Finish Test" id="ajaxfinish" update="growl,ajaxfinish,ajaxstart,levelsids,tpoll,:QuestionsListForm:questionAnswer,datalist,datalistpanel" action="#{questionsController.finishtest}"  />
                </p:panel>
                
                <p:panel id="datalistpanel" header="#{bundle.ListQuestionsTitle}" visible="#{questionsController.teststarted}">
                    <p:dataTable id="datalist" value="#{questionsController.items}" var="item"
                                 selectionMode="single" selection="#{questionsController.selected}"
                                 paginator="true"
                                 rowKey="#{item.id}"
                                 rows="1" 
                                 paginatorTemplate="{CurrentPageReport} {NextPageLink} {LastPageLink}"
                                 widgetVar="cellQuestions"
                                  >
                       <p:ajax event="rowSelect" update=":QuestionsListForm:questionAnswer" oncomplete="PF('queansDialog').show()" />
                       <p:ajax event="page" listener="#{questionsController.onnextpage}" update=":QuestionsListForm:questionAnswer"></p:ajax>
                       
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListQuestionsTitle_questiontext}"/>
                            </f:facet>
                            <h:outputText value="#{item.questiontext}"/>
                            <img src="data:image/png;base64,#{item.questioimage}" width="100" height="100" />
                        </p:column>
                        <p:column headerText="#{bundle.ListQuestionsTitle_questionanswer}">
                                <h:outputText value="#{questionsController.result}"/>
                        </p:column>
                        <p:column>
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListQuestionsTitle_questionpoint}"/>
                            </f:facet>
                            <h:outputText value="#{item.questionpoint}"/>
                        </p:column>

                    </p:dataTable>
                    <p:dialog header="Question Answer" widgetVar="queansDialog" modal="true" showEffect="fade" hideEffect="fade" resizable="false">
                        <p:outputPanel id="questionAnswer" style="text-align:center;">
                            <p:panelGrid  columns="2" rendered="#{not empty questionsController.selected}" columnClasses="label,value">
                                <f:facet name="header">
                                    <h:outputText value="#{bundle.ListQuestionsTitle_questiontext}:"/> <h:outputText value="#{questionsController.selected.questiontext}"/>
                                    <img src="data:image/png;base64,#{questionsController.selected.questioimage}" width="100" height="100" />
                                </f:facet>

                                <h:outputText value="Answer:" />
                                <p:panel id="panel1" visible="#{questionsController.selected.questiontype}" toggleable="true">
                                    <p:selectOneRadio id="console" value="#{questionsController.result}" unselectable="true"   >
                                       <f:selectItem itemLabel="#{questionsController.selected.questionanswera}" itemValue="A" />
                                       <f:selectItem itemLabel="#{questionsController.selected.questionanswerb}" itemValue="B" />
                                       <f:selectItem itemLabel="#{questionsController.selected.questionanswerc}" itemValue="C" />
                                       <f:selectItem itemLabel="#{questionsController.selected.questionanswerd}" itemValue="D" />
                                       <p:ajax update="resx" />
                                    </p:selectOneRadio>
                                </p:panel>
                                <p:panel id="panel2" visible="#{!questionsController.selected.questiontype}" toggleable="true">
                                    <p:inputText value="#{questionsController.result}" style="width:100%" label="Answer">
                                         <p:ajax update="resx" />  
                                    </p:inputText>
                                </p:panel> 
                                <p:inputText id="resx" value="#{questionsController.result}" style="width:100%" label="Answer"/>
                                <p:commandButton value="#{bundle.Close}" actionListener="#{questionsController.onsaveresult}" update="questionAnswer,:QuestionsListForm:datalist,:growl" oncomplete="handleSubmit(args,'queansDialog');"/>
                                
                            </p:panelGrid>
                        </p:outputPanel>
                    </p:dialog>
                </p:panel>
            </h:form>


        </ui:define>
    </ui:composition>

</html>
